<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®°å¿†å¥åº·åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f8ff;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .score-box {
            font-size: 24px;
            font-weight: bold;
        }
        .record-table {
            width: 100%;
            border-collapse: collapse;
        }
        .record-table th, .record-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        .radar-container {
            width: 100%;
            max-width: 500px;
            margin: auto;
        }
        .line-chart-container {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
    </style>
</head>
<body>
    <h1>è®°å¿†å¥åº·åˆ†ææŠ¥å‘Š</h1>

    <!-- Section 1: è®°å¿†èƒ½åŠ›åˆ†æ -->
    <div class="section">
        <h2>ğŸ§  è®°å¿†èƒ½åŠ›åˆ†æ</h2>
        <p class="score-box">æ•´ä½“è®°å¿†è¯„åˆ†ï¼š<span style="color: #007bff;">-</span></p>
        <p id="summary-text">åˆ†ææ€»ç»“ï¼š-</p>
        <ul>
            <li>çŸ­æ—¶è®°å¿†ï¼š-</li>
            <li>æ³¨æ„åŠ›ç»´æŒï¼š-</li>
            <li>ååº”é€Ÿåº¦ï¼š-</li>
            <li>é¡ºåºè®°å¿†ï¼š-</li>
            <li>å¹²æ‰°æŠµæŠ—åŠ›ï¼š-</li>
        </ul>
    </div>

    <!-- Section 2: é€šå…³è®°å½•æ•°æ® -->
    <div class="section">
        <h2>ğŸ“Š é€šå…³è®°å½•æ•°æ®</h2>
        <table class="record-table">
            <thead>
                <tr>
                    <th>å…³å¡</th>
                    <th>ç”¨æ—¶</th>
                    <th>é”™è¯¯æ¬¡æ•°</th>
                    <th>æˆåŠŸç‡</th>
                    <th>è¯„åˆ†</th>
                    <th>å¤‡æ³¨</th>
                </tr>
            </thead>
            <tbody>
                <!-- åŠ¨æ€æ’å…¥è¡Œ -->
            </tbody>
        </table>
    </div>

    <!-- Section 3: é›·è¾¾å›¾ + è¯„åˆ† -->
    <div class="section">
        <h2>ğŸ“ˆ è®°å¿†èƒ½åŠ›é›·è¾¾å›¾</h2>
        <div class="radar-container">
            <canvas id="memoryRadar"></canvas>
        </div>
    </div>

    <!-- Section 4: è®°å¿†è¯„åˆ†è¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰ -->
    <div class="section">
        <h2>ğŸ“… è®°å¿†è¯„åˆ†è¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰</h2>
        <div class="line-chart-container">
            <canvas id="scoreTrendChart"></canvas>
        </div>
    </div>

    <script>
     let radarChart;
        let scoreTrendChart;

        window.addEventListener("DOMContentLoaded", function () {
            const data = JSON.parse(localStorage.getItem("memoryGameResult"));
            
            if (data) {
                // æ›´æ–°æ•´ä½“è¯„åˆ†
                document.querySelector('.score-box span').textContent = `${data.overallScore} / 100`;

                // æ›´æ–°åˆ†ææ€»ç»“
                const summaryText = data.abilities.sequence < 70
                    ? "æ‚¨çš„çŸ­æ—¶è®°å¿†ä¸ååº”é€Ÿåº¦è¡¨ç°è‰¯å¥½ï¼Œé¡ºåºè®°å¿†ç•¥å¼±ï¼Œå»ºè®®é‡ç‚¹æå‡ã€‚"
                    : "å„é¡¹è®°å¿†èƒ½åŠ›è¡¨ç°å‡è¡¡ï¼Œè¯·ç»§ç»­ä¿æŒã€‚";
                document.getElementById("summary-text").textContent = "åˆ†ææ€»ç»“ï¼š" + summaryText;

                // æ›´æ–°å„é¡¹èƒ½åŠ›åˆ†
                const listItems = document.querySelectorAll(".section ul li");
                listItems[0].textContent = "çŸ­æ—¶è®°å¿†ï¼š" + data.abilities.shortTerm;
                listItems[1].textContent = "æ³¨æ„åŠ›ç»´æŒï¼š" + data.abilities.attention;
                listItems[2].textContent = "ååº”é€Ÿåº¦ï¼š" + data.abilities.reaction;
                listItems[3].textContent = "é¡ºåºè®°å¿†ï¼š" + data.abilities.sequence;
                listItems[4].textContent = "å¹²æ‰°æŠµæŠ—åŠ›ï¼š" + data.abilities.resistance;

                // æ›´æ–°è¡¨æ ¼
                const tbody = document.querySelector(".record-table tbody");
                tbody.innerHTML = "";
                data.levels.forEach((lvl) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${lvl.level}</td>
                        <td>${lvl.time}s</td>
                        <td>${lvl.errors}</td>
                        <td>${Math.round(lvl.accuracy * 100)}%</td>
                        <td>${lvl.score}</td>
                        <td>${lvl.note}</td>
                    `;
                    tbody.appendChild(row);
                });

                // æ›´æ–°é›·è¾¾å›¾æ•°æ®
                radarChart.data.datasets[0].data = [
                    data.abilities.shortTerm,
                    data.abilities.attention,
                    data.abilities.reaction,
                    data.abilities.sequence,
                    data.abilities.resistance
                ];
                radarChart.update();
            }

            // æ˜¾ç¤ºå½“å¤©æ—¥æœŸ
            const today = new Date();
            const todayStr = today.toLocaleDateString('zh-CN');
            const todayElement = document.createElement('p');
            todayElement.textContent = `ä»Šå¤©æ˜¯ï¼š${todayStr}`;
            document.body.prepend(todayElement);

            // å¤„ç†å†å²è®°å½•æ•°æ®
            const historyData = JSON.parse(localStorage.getItem("memoryGameHistory")) || [];
            const last30Days = historyData.filter(item => {
                const itemDate = new Date(item.date);
                return (today - itemDate) <= (30 * 24 * 60 * 60 * 1000); // è¿‡å»30å¤©çš„æ•°æ®
            });

            const dates = last30Days.map(item => item.date);
            const scores = last30Days.map(item => item.overallScore);

            // ç»˜åˆ¶æŠ˜çº¿å›¾
            const ctx = document.getElementById('scoreTrendChart').getContext('2d');
            scoreTrendChart = new Chart(ctx, {
                type: 'line', // æŠ˜çº¿å›¾
                data: {
                    labels: dates, // æ¨ªåæ ‡ï¼šæ—¥æœŸ
                    datasets: [{
                        label: 'è®°å¿†è¯„åˆ†',
                        data: scores, // çºµåæ ‡ï¼šå¾—åˆ†
                        fill: false,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'è®°å¿†è¯„åˆ†'
                            },
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
        });

        // åˆå§‹åŒ–é›·è¾¾å›¾
        const ctx = document.getElementById('memoryRadar').getContext('2d');
        radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['çŸ­æ—¶è®°å¿†', 'æ³¨æ„åŠ›', 'ååº”é€Ÿåº¦', 'é¡ºåºè®°å¿†', 'å¹²æ‰°æŠµæŠ—åŠ›'],
                datasets: [{
                    label: 'è®°å¿†è¯„åˆ†',
                    data: [0, 0, 0, 0, 0], // åˆå§‹ä¸ºç©º
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                scales: {
                    r: {
                        min: 0,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
